machine:
  java:
    version: openjdk8
  environment:
    TERM: dumb
    FIREFOX_VERSION: 46.0.1
    PHANTOMJS_VERSION: 2.1.1
    CHROME_VERSION: stable_current
    DBUS_SESSION_BUS_ADDRESS: /dev/null
    SCREEN_WIDTH: 1360
    SCREEN_HEIGHT: 1020
    SCREEN_DEPTH: 24
    PATH: ~/.bin:$PATH

dependencies:
  pre:
    - ./grailsw refresh-dependencies
    - sudo -E bash -x ./install-browsers.sh
  cache_directories:
    - "~/.grails"
    - "~/.bin"
    - "/opt/firefox-46.0.1"

test:
  pre:
    - mkdir -p $CIRCLE_TEST_REPORTS/phantomjs $CIRCLE_TEST_REPORTS/chrome $CIRCLE_TEST_REPORTS/firefox
  override:
    - ./grailsw -Dgeb.env=chrome -Dgrails.project.test.reports.dir=$CIRCLE_TEST_REPORTS/chrome test-app
    - ./grailsw -Dgeb.env=firefox -Dgrails.project.test.reports.dir=$CIRCLE_TEST_REPORTS/firefox test-app
    - ./grailsw -Dgeb.env=phantomjs -Dgrails.project.test.reports.dir=$CIRCLE_TEST_REPORTS/phantomjs test-app

